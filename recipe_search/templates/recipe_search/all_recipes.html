{% extends "base.html" %}
{% load static %}

{% block title %}All Recipes | Recipe Reapers{% endblock %}

{% block content %}
  <main class="all-recipes-page pb-5">
    <section class="py-5 bg-light border-bottom">
      <div class="container text-center">
        <p class="text-uppercase text-muted fw-semibold small mb-2">All Recipes</p>
        <h1 class="display-5 fw-bold mb-3">Find Your Next Frightful Favorite</h1>
        <p class="lead text-secondary mb-0">
          Browse every recipe in the vault, try out new themes, and tune the fright level to suit your coven.
        </p>
      </div>
    </section>

    <section class="py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-xl-8 text-center">
            <h2 class="fw-bold mb-3">Search the Recipe Vault</h2>
            <p class="text-muted mb-0">Summon every dish in the collection or whisper a keyword to narrow the spell.</p>
          </div>
        </div>
        <div class="row justify-content-center mt-4">
          <div class="col-xl-10">
            <form class="recipe-filter-form" method="get" action="">
              <div class="row g-2 align-items-center mt-3">
                <div class="col-lg-9 col-sm-8">
                  <label class="visually-hidden" for="recipe-search">Search recipes</label>
                  <input
                    id="recipe-search"
                    name="q"
                    type="search"
                    class="form-control form-control-lg search-input"
                    placeholder="Search recipes..."
                    value="{{ search_query }}"
                    autocomplete="off"
                  />
                </div>
                <div class="col-lg-3 col-sm-4">
                  <button type="submit" class="btn btn-dark search-btn w-100">
                    <span class="visually-hidden">Search</span>
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section class="pb-5">
      <div class="container">
        {% if recipe_cards %}
          <div class="row row-cols-1 row-cols-md-2 g-4 mt-1">
            {% for card in recipe_cards %}
              <div class="col">
                <h1 class="h5 fw-bold">{{ card.recipe.title }}</h1>
                <article class="card recipe-card border-0 shadow-sm h-100">
                  <div class="ratio ratio-16x9 recipe-card__image">
                    {% if card.recipe.image %}
                      <img
                        src="{{ card.recipe.image.url }}"
                        alt="{{ card.recipe.title }}"
                        class="w-100 h-100"
                        style="object-fit: cover;"
                      />
                    {% else %}
                      <span class="recipe-card__image-placeholder">Image Placeholder</span>
                    {% endif %}
                  </div>
                  <div class="card-body text-start d-flex flex-column">

                    <p class="text-secondary small mb-4 flex-grow-1">{{ card.recipe.recipe|truncatewords:40 }}</p>
                    <div class="fright-meter mb-4">
                      <div class="fright-meter__bar">
                        <div
                          class="fright-meter__indicator"
                          style="left: {{ card.pointer_percent }}%;"
                          aria-hidden="true"
                        ></div>
                        <div
                          class="fright-meter__pointer"
                          style="left: {{ card.pointer_percent }}%;"
                          role="img"
                          aria-label="Trick intensity {{ card.trick_percent }} percent"
                        >
                          <span class="fright-meter__pointer-icon" aria-hidden="true">ðŸŽƒ</span>
                          <span class="fright-meter__pointer-value">{{ card.trick_percent }}%</span>
                        </div>
                        <div class="fright-meter__segment fright-meter__segment--trick" style="width: {{ card.trick_percent }}%;"></div>
                        <div class="fright-meter__segment fright-meter__segment--treat" style="width: {{ card.treat_percent }}%;"></div>
                      </div>
                      <div class="fright-meter__labels text-uppercase small fw-semibold">
                        <span>Trick</span>
                        <span>Treat</span>
                      </div>
                    </div>
                    <div class="d-flex gap-3">

                    </div>
                  </div>
                </article>
              </div>
            {% endfor %}
          </div>
          <p class="text-center text-muted mt-4 small">Showing {{ results_count }} bewitched creations.</p>
        {% else %}
          <div class="expandable-placeholder text-center text-muted">
            <span class="d-block fw-semibold mb-2">No recipes found just yet.</span>
            <p class="mb-0">Try resetting your filters or entering a different search term.</p>
          </div>
        {% endif %}
      </div>
    </section>
  </main>
{% endblock content %}
