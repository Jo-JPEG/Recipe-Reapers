{% extends "base.html" %}
{% load static %}


{% block content %}
  <main class="homepage pb-5">
    <section class="py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8 text-center text-lg-start">
            <p class="text-uppercase text-muted fw-semibold mb-2">Welcome to</p>
            <h1 class="display-4 fw-bold">Recipe Reapers</h1>
            <p class="lead text-secondary mb-0">
              Brew spine-chilling treats, rank your favorite cursed confections, and join a coven
              of fellow mischief-makers in the kitchen.
            </p>
          </div>
        </div>
        {% if not user.is_authenticated %}
          <div class="row justify-content-center mt-5">
            <div class="col-lg-5">
              <div class="card shadow-sm border-0">
                <div class="card-body p-4 text-center text-lg-start">
                  <h2 class="h4 fw-bold mb-2 text-center text-lg-start">Join the Coven</h2>
                  <p class="text-muted">
                    AllAuth Login template to be inserted here.
                  </p>
                  <div class="d-grid gap-2">
                    <a class="btn btn-primary" href="#">Log In</a>
                    <a class="btn btn-outline-dark" href="#">Sign Up</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </section>
    <section class="py-5 bg-light">
      <div class="container">
        <div class="text-center mb-4">
          <a class="all-recipes-cta" href="{% url 'all_recipes' %}">
            <span class="all-recipes-cta__icon">üï∏Ô∏è</span>
            <span class="all-recipes-cta__label">Unveil the Full Grimoire</span>
            <span class="all-recipes-cta__icon">üïØÔ∏è</span>
          </a>
        </div>
        <div class="row justify-content-center">
          <div class="col-xl-8">
            <h2 class="fw-bold text-center mb-3">Find a Recipe</h2>
            <p class="text-muted text-center mb-4">
              Search across the Recipe Reapers collection for the perfect cursed creation.
            </p>
            <form class="input-group input-group-lg shadow-sm" method="post" action="">
              {% csrf_token %}
              <label class="visually-hidden" for="homepage-search">Search for recipes</label>
              <input
                id="homepage-search"
                name="q"
                type="search"
                class="form-control border-0"
                placeholder="Search for recipes..."
                autocomplete="off"
                value="{{ search_query }}"
              />
              <button type="submit" class="btn btn-primary px-4">
                <i class="fas fa-search me-2"></i>
                Search
              </button>
            </form>
            {% if request.method == "POST" %}
              {% if relevant_recipes %}
                <div class="row row-cols-1 row-cols-md-2 g-4 mt-5">
                  {% for recipe in relevant_recipes %}
                    <div class="col">
                      <article class="card h-100 shadow-sm border-0">
                        <div class="ratio ratio-4x3 card-img-top bg-dark bg-opacity-10 rounded-top overflow-hidden">
                          {% if recipe.image %}
                            <img
                              src="{{ recipe.image.url }}"
                              alt="{{ recipe.title }}"
                              class="w-100 h-100"
                              style="object-fit: cover;"
                            />
                          {% endif %}
                        </div>
                        <div class="card-body d-flex flex-column">
                          <h3 class="h5 mb-2">{{ recipe.title }}</h3>
                          <p class="text-secondary small flex-grow-1">
                            {{ recipe.recipe|truncatewords:40 }}
                          </p>
                          <a
                            class="btn btn-primary mt-3 align-self-start"
                            href="{% url 'all_recipes' %}?q={{ recipe.title|urlencode }}"
                          >
                            View Recipe
                          </a>
                        </div>
                      </article>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="border border-2 border-secondary border-opacity-25 rounded-3 p-4 text-center text-muted mt-5">
                  <p class="mb-2">
                    {% if search_query %}
                      No matches for &ldquo;{{ search_query }}&rdquo;.
                    {% else %}
                      No search submitted.
                    {% endif %}
                  </p>
                  <p class="mb-0">Try another spooky keyword to conjure a recipe.</p>
                </div>
              {% endif %}
            {% endif %}
            {# Featured recipe intentionally hidden on non-search state #}
          </div>
        </div>
      </div>
    </section>

    <section class="py-5 sacred-section">
      <div class="container">
        <div class="row justify-content-between align-items-end gy-3">
          <div class="col-lg-8">
            <h2 class="fw-bold mb-1">Sacred Treats</h2>
            <p class="text-muted mb-0">Sweet creations blessed by the coven.</p>
          </div>
        </div>
        {% if sacred_treats %}
          <div class="row g-4 mt-1">
            {% for recipe in sacred_treats %}
              <div class="col-md-6 col-lg-4">
                <article class="card h-100 shadow-sm border-0">
                  <div class="ratio ratio-4x3 card-img-top bg-dark bg-opacity-10 rounded-top overflow-hidden">
                    {% if recipe.image %}
                      <img
                        src="{{ recipe.image.url }}"
                        alt="{{ recipe.title }}"
                        class="w-100 h-100"
                        style="object-fit: cover;"
                      />
                    {% endif %}
                  </div>
                  <div class="card-body d-flex flex-column">
                    <h3 class="h5 mb-2">{{ recipe.title }}</h3>
                    <p class="text-secondary small flex-grow-1">
                      {{ recipe.recipe|truncatewords:36 }}
                    </p>
                    <a
                      class="btn btn-warning text-dark mt-3 align-self-start"
                      href="{% url 'all_recipes' %}?q={{ recipe.title|urlencode }}"
                    >
                      View Recipe
                    </a>
                  </div>
                </article>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="border border-2 border-secondary border-opacity-25 rounded-3 p-5 text-center text-muted mt-4">
            <p class="mb-0">No sacred treats yet. Submit a sweet masterpiece to bless the table.</p>
          </div>
        {% endif %}
      </div>
    </section>

    <section class="py-5 cursed-section">
      <div class="container">
        <div class="row justify-content-between align-items-end gy-3">
          <div class="col-lg-8">
            <h2 class="fw-bold mb-1">Cursed Hall of Fame</h2>
            <p class="text-muted mb-0">Most tricked creations as voted by the coven.</p>
          </div>
        </div>
        {% if hall_of_fame %}
          <div class="row g-4 mt-1">
            {% for recipe in hall_of_fame %}
              <div class="col-md-6 col-lg-4">
                <article class="card h-100 shadow-sm border-0">
                  <div class="ratio ratio-4x3 card-img-top bg-dark bg-opacity-10 rounded-top overflow-hidden">
                    {% if recipe.image %}
                      <img
                        src="{{ recipe.image.url }}"
                        alt="{{ recipe.title }}"
                        class="w-100 h-100"
                        style="object-fit: cover;"
                      />
                    {% endif %}
                  </div>
                  <div class="card-body d-flex flex-column">
                    <h3 class="h5 mb-2">{{ recipe.title }}</h3>
                    <p class="text-secondary small flex-grow-1">
                      {{ recipe.recipe|truncatewords:36 }}
                    </p>
                    <a
                      class="btn btn-primary mt-3 align-self-start"
                      href="{% url 'all_recipes' %}?q={{ recipe.title|urlencode }}"
                    >
                      View Recipe
                    </a>
                  </div>
                </article>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="border border-2 border-secondary border-opacity-25 rounded-3 p-5 text-center text-muted mt-4">
            <p class="mb-0">No cursed champions yet. Add your first recipe to awaken the leaderboard.</p>
          </div>
        {% endif %}
      </div>
    </section>

  </main>
{% endblock content %}
